<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saree Shop Management System</title>
    <style>
        :root {
            --primary-color: #8B4513;  /* Maroon Brown */
            --secondary-color: #D2B48C; /* Cream/Gold */
            --text-color: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f4f4f4;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav {
            display: flex;
            background-color: var(--primary-color);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .nav-button {
            background-color: transparent;
            color: white;
            border: none;
            padding: 10px 15px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-button:hover {
            background-color: #6B3E23;
        }

        .nav-button.active {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        /* Main Container */
        .main-container {
            display: none;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            padding: 15px;
            min-height: calc(100vh - 120px);
        }

        .main-container.active {
            display: block;
        }

        /* Billing Page */
        .billing-layout {
            display: grid;
            grid-template-columns: 200px 1fr 450px;
            gap: 15px;
            height: 100%;
        }

        /* Inventory Page */
        .inventory-container {
            padding: 15px;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .bill-list {
            border: 1px solid #eee;
            border-radius: 5px;
            overflow: hidden;
        }

        .bill-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .bill-item:hover {
            background-color: #f9f9f9;
        }

        .bill-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .bill-number {
            font-weight: bold;
            color: var(--primary-color);
        }

        .bill-date {
            color: #666;
            font-size: 13px;
        }

        .bill-customer {
            margin-bottom: 5px;
        }

        .bill-total {
            font-weight: bold;
            color: green;
        }

        .bill-details {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }

        /* Shared Styles */
        .categories-section, .items-section, .billing-section {
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            overflow-y: auto;
        }

        .categories-title, .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .category {
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .category:hover {
            background-color: #f8f8f8;
        }

        .category.active {
            background-color: #f8f8f8;
            border-left: 4px solid var(--primary-color);
            font-weight: bold;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .item-card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            border-color: var(--secondary-color);
        }

        .item-code {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 13px;
        }

        .item-name {
            margin: 4px 0;
            font-size: 14px;
        }

        .item-price {
            color: green;
            font-weight: bold;
            font-size: 15px;
        }

        .item-category {
            font-size: 11px; 
            color:#666;
            margin-top: 4px;
        }

        .item-stock {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .low-stock {
            background-color: #fff8e1;
            color: #ff8f00;
        }

        .out-of-stock {
            background-color: #ffebee;
            color: #c62828;
        }

        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .bill-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 13px;
        }

        .bill-table th {
            background-color: var(--secondary-color);
            padding: 8px;
            font-weight: bold;
        }

        .bill-table td {
            padding: 8px 5px;
            border-bottom: 1px solid #eee;
        }

        .total-row {
            font-weight: bold;
            background-color: #f5f5f5;
        }

        .grand-total {
            font-weight: bold;
            font-size: 15px;
            background-color: var(--secondary-color);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .btn:hover {
            background-color: #6B3E23;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }

        .customer-details {
            margin-bottom: 15px;
        }

        .payment-methods {
            margin-top: 15px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .payment-method input {
            margin-right: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .empty-category {
            color: #999;
            font-style: italic;
            padding: 20px;
            text-align: center;
        }

        .bill-table .discount-input {
            width: 40px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
        }

        /* Analytics Page Styles */
        .analytics-container {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .analytics-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .analytics-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
            margin-bottom: 15px;
            font-size: 16px;
        }

        /* Circular Progress for Daily Sales */
        .progress-container {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
        }

        .progress-circle {
            width: 100%;
            height: 100%;
        }

        .progress-circle-bg {
            fill: none;
            stroke: #f0f0f0;
            stroke-width: 10;
        }

        .progress-circle-fill {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 10;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .progress-label {
            font-size: 14px;
            color: #666;
        }

        /* Stock Analysis Table */
        .stock-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .stock-table th {
            background-color: var(--secondary-color);
            padding: 10px;
            text-align: left;
        }

        .stock-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
        }

        .good-stock {
            background-color: #e8f5e9;
        }

        .low-stock-row {
            background-color: #fff8e1;
        }

        .dead-stock {
            background-color: #ffebee;
        }

        /* Sales Chart Container */
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="nav">
        <button class="nav-button active" onclick="showPage('billing')">Billing</button>
        <button class="nav-button" onclick="showPage('inventory')">Inventory</button>
        <button class="nav-button" onclick="showPage('analytics')">Analytics</button>
    </div>

    <!-- Billing Page -->
    <div id="billing-page" class="main-container active">
        <div class="billing-layout">
            <!-- Categories Section -->
            <div class="categories-section">
                <div class="categories-title">Product Categories</div>
                <div class="category active">All Products</div>
                <div class="category">Sarees</div>
                <div class="category">Chudidhars</div>
                <div class="category">Blouses</div>
                <div class="category">Nighties</div>
                <div class="category">Dhotis</div>
                <div class="category">In-skirts</div>
            </div>

            <!-- Items Section -->
            <div class="items-section">
                <div class="section-title">Available Products</div>
                <div class="items-grid" id="itemsGrid">
                    <!-- Items will be added here dynamically -->
                </div>
            </div>

            <!-- Billing Section -->
            <div class="billing-section">
                <div class="section-title">Billing Details</div>
                
                <div class="customer-details">
                    <input type="text" id="billNumber" readonly class="form-control" placeholder="Bill Number" value="1001">
                    <input type="date" id="billDate" required class="form-control" value="">
                    <input type="text" id="customerName" class="form-control" placeholder="Customer Name">
                    <input type="text" id="customerPhone" class="form-control" placeholder="Customer Phone">
                </div>
                
                <table class="bill-table" id="billTable">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Disc%</th>
                            <th>Qty</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="billItems"></tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="5">Subtotal</td>
                            <td id="subtotalAmount">₹0</td>
                            <td></td>
                        </tr>
                        <tr class="grand-total">
                            <td colspan="5">Grand Total</td>
                            <td id="grandTotal">₹0</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
                
                <div class="payment-methods">
                    <div class="section-title">Payment Method</div>
                    <div class="payment-method">
                        <input type="radio" id="cash" name="payment" checked>
                        <label for="cash">Cash</label>
                    </div>
                    <div class="payment-method">
                        <input type="radio" id="card" name="payment">
                        <label for="card">Card</label>
                    </div>
                    <div class="payment-method">
                        <input type="radio" id="upi" name="payment">
                        <label for="upi">UPI</label>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn" id="printBillBtn">Print Bill</button>
                    <button class="btn" id="saveBillBtn">Save Bill</button>
                    <button class="btn" id="newBillBtn">New Bill</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Page -->
    <div id="inventory-page" class="main-container">
        <div class="inventory-container">
            <h2>Saved Bills</h2>
            <div class="search-box">
                <input type="text" id="searchBills" placeholder="Search bills by customer name, phone, or bill number..." oninput="filterBills()">
            </div>
            <div class="bill-list" id="billList">
                <!-- Saved bills will appear here -->
            </div>
        </div>
    </div>

    <!-- Analytics Page -->
    <div id="analytics-page" class="main-container">
        <div class="analytics-container">
            <!-- Daily Sales Card -->
            <div class="analytics-card">
                <div class="analytics-title">Daily Sales Performance</div>
                <div class="progress-container">
                    <svg class="progress-circle" viewBox="0 0 100 100">
                        <circle class="progress-circle-bg" cx="50" cy="50" r="45"></circle>
                        <circle class="progress-circle-fill" cx="50" cy="50" r="45" 
                                stroke-dasharray="283" stroke-dashoffset="283"></circle>
                    </svg>
                    <div class="progress-text">
                        <div class="progress-value" id="daily-sales-value">₹0</div>
                        <div class="progress-label">Today's Sales</div>
                    </div>
                </div>
                <div id="daily-sales-details"></div>
            </div>

            <!-- Stock Analysis Card -->
            <div class="analytics-card">
                <div class="analytics-title">Stock Analysis</div>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Count</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="stock-analysis-body">
                        <!-- Will be filled by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Product Performance Card (Full Width) -->
            <div class="analytics-card" style="grid-column: span 2;">
                <div class="analytics-title">Top Performing Products</div>
                <div id="top-products-chart" class="chart-container">
                    <!-- Chart will be rendered here -->
                </div>
            </div>

            <!-- Dead Stock Card -->
            <div class="analytics-card" style="grid-column: span 2;">
                <div class="analytics-title">Dead Stock (No sales in last 30 days)</div>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Product Code</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Stock Qty</th>
                            <th>Last Sale</th>
                        </tr>
                    </thead>
                    <tbody id="dead-stock-body">
                        <!-- Will be filled by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ========== GLOBAL VARIABLES ==========
        let savedBills = JSON.parse(localStorage.getItem('sareeShopBills')) || [];
        let products = JSON.parse(localStorage.getItem('sareeShopProducts')) || [];
        let currentBillNumber = savedBills.length > 0 ? 
            Math.max(...savedBills.map(bill => parseInt(bill.billNumber))) + 1 : 1001;

        // Initialize products if empty
        if (products.length === 0) {
            products = [
                // ====== SAREES ======
                // KHP Series
                { code: "KHP01-06", name: "Ekkath kotta Saree", price: 840, category: "Sarees", qty: 6, sold: 0 },
                { code: "KHP02-1-10", name: "Ekkath kotta Saree", price: 680, category: "Sarees", qty: 10, sold: 0 },
                { code: "KHP3-1-5", name: "Cotton Saree", price: 1250, category: "Sarees", qty: 5, sold: 0 },
                { code: "KHP3-6-11", name: "Cotton Saree", price: 1350, category: "Sarees", qty: 6, sold: 0 },
                
                // LTN Series
                { code: "LTN-2646-1-5", name: "Zari Border Saree", price: 780, category: "Sarees", qty: 5, sold: 0 },
                { code: "LTN-8790-1-2", name: "Zari Border Saree", price: 920, category: "Sarees", qty: 2, sold: 0 },
                { code: "LTN-9227-1-5", name: "Zari Border Saree", price: 750, category: "Sarees", qty: 5, sold: 0 },
                { code: "LTN-6551-4", name: "Muthukattam Saree", price: 900, category: "Sarees", qty: 4, sold: 0 },
                { code: "LTN-6091-10", name: "Plain Kanchi Border", price: 600, category: "Sarees", qty: 10, sold: 0 },
                { code: "LTN-9430-6", name: "Plain Kanchi Border", price: 1100, category: "Sarees", qty: 6, sold: 0 },
                { code: "LTN-1084-5", name: "Butta Kanchi Border", price: 1000, category: "Sarees", qty: 5, sold: 0 },
                { code: "LTN-6870-8", name: "Butta Kanchi Border", price: 970, category: "Sarees", qty: 8, sold: 0 },
                { code: "LTN-5977-5", name: "Agarlic Cotton Silk", price: 1550, category: "Sarees", qty: 5, sold: 0 },
                { code: "LTN-8739-5", name: "Agarlic Seer Pallu", price: 1700, category: "Sarees", qty: 5, sold: 0 },
                { code: "LTN-9604-5", name: "Agarlic Cotton Butta", price: 3450, category: "Sarees", qty: 5, sold: 0 },
                
                // RVV Series
                { code: "RVV-1-14", name: "Kalyani Cotton", price: 850, category: "Sarees", qty: 14, sold: 0 },
                { code: "RVV-2-7", name: "Kalyani Big Border", price: 900, category: "Sarees", qty: 7, sold: 0 },
                { code: "RVV-3-13", name: "Zari Border", price: 1100, category: "Sarees", qty: 13, sold: 0 },
                { code: "RVV-4-5", name: "Muthukattam", price: 1090, category: "Sarees", qty: 5, sold: 0 },
                { code: "RVV-5-7", name: "Plain Kanchi", price: 1650, category: "Sarees", qty: 8, sold: 0 },
                { code: "RVV-6-8", name: "Plain Kanchi", price: 1800, category: "Sarees", qty: 8, sold: 0 },
                { code: "RVV-7-1", name: "Butta Kanchi", price: 1600, category: "Sarees", qty: 1, sold: 0 },
                
                // SSE Series
                { code: "SSE-0205", name: "Pathik Saree", price: 850, category: "Sarees", qty: 1, sold: 0 },
                { code: "SSE-19", name: "Mallika 5.50 Mtr", price: 550, category: "Sarees", qty: 20, sold: 0 },
                { code: "SSE-013", name: "Pathik Chudi", price: 1400, category: "Sarees", qty: 1, sold: 0 },
                { code: "SSE-0166", name: "Pathik Chudi", price: 1090, category: "Sarees", qty: 2, sold: 0 },
                { code: "SSE-0204", name: "Pathik Saree", price: 1650, category: "Sarees", qty: 3, sold: 0 },
                { code: "SSE-0200", name: "Pathik Saree", price: 750, category: "Sarees", qty: 1, sold: 0 },
                { code: "SSE-145", name: "Malliga Cool", price: 585, category: "Sarees", qty: 10, sold: 0 },
                { code: "SSE-199", name: "Malliga Cool", price: 1000, category: "Sarees", qty: 9, sold: 0 },
                { code: "SSE-093", name: "SSS Kotta", price: 600, category: "Sarees", qty: 10, sold: 0 },
                { code: "SSE-95", name: "Jaikali", price: 600, category: "Sarees", qty: 5, sold: 0 },
                
                // SSSK Series
                { code: "SSSK-1-8", name: "Ekkath Kotta", price: 950, category: "Sarees", qty: 8, sold: 0 },
                { code: "SSSK-2-1-20", name: "Ekkath Kotta", price: 1550, category: "Sarees", qty: 20, sold: 0 },
                
                // VWCS Series
                { code: "VWCS-1-1-2", name: "Zari Border", price: 1150, category: "Sarees", qty: 2, sold: 0 },
                { code: "VWCS-1-1-3-4", name: "Zari Border", price: 1250, category: "Sarees", qty: 2, sold: 0 },
                { code: "VWCS-1-1-5-7", name: "Zari Border", price: 1300, category: "Sarees", qty: 3, sold: 0 },
                { code: "VWCS-2-1-6", name: "Muthukattam", price: 1390, category: "Sarees", qty: 6, sold: 0 },
                { code: "VWCS-3-1-15", name: "Plain Kanchi", price: 1650, category: "Sarees", qty: 15, sold: 0 },
                { code: "VWCS-3-16=20", name: "Plain Kanchi", price: 1570, category: "Sarees", qty: 5, sold: 0 },
                { code: "VWCS-4-1-7", name: "Butta Kanchi", price: 1600, category: "Sarees", qty: 5, sold: 0 },
                { code: "VWCS-4-8-10", name: "Butta Kanchi", price: 1720, category: "Sarees", qty: 5, sold: 0 },
                { code: "VWCS-5-1-14", name: "Agarlic Silk", price: 1360, category: "Sarees", qty: 14, sold: 0 },
                { code: "VWCS-6-1-7", name: "Seer Pallu", price: 1260, category: "Sarees", qty: 7, sold: 0 },
                { code: "VWCS-7-1-2", name: "Agarlic Butta", price: 1500, category: "Sarees", qty: 2, sold: 0 },
                { code: "VWCS-8-1-3", name: "Vaiaroosi", price: 1800, category: "Sarees", qty: 3, sold: 0 },
                { code: "VWCS-9-1-14", name: "Kattam Butta", price: 1850, category: "Sarees", qty: 14, sold: 0 },
                { code: "VWCS-10-1-8", name: "Muthukattam", price: 2000, category: "Sarees", qty: 8, sold: 0 },
                { code: "VWCS-11-1-5", name: "Plain Araimadam", price: 2100, category: "Sarees", qty: 5, sold: 0 },
                { code: "VWCS-12-1-4", name: "Plain Kanchi", price: 2450, category: "Sarees", qty: 4, sold: 0 },
                
                // MG Series (Sarees)
                { code: "MG-1324-1", name: "Cotton Saree", price: 1450, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1324-2", name: "Cotton Saree", price: 1450, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1030-1", name: "Cotton Saree", price: 1800, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1030-2", name: "Cotton Saree", price: 1800, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1004-1", name: "Cotton Saree", price: 2000, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1004-2", name: "Cotton Saree", price: 2000, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1323-1", name: "Cotton Saree", price: 1450, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1323-2", name: "Cotton Saree", price: 1450, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1323-3", name: "Cotton Saree", price: 1450, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1326-1", name: "Cotton Saree", price: 1600, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1326-2", name: "Cotton Saree", price: 1600, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1326-3", name: "Cotton Saree", price: 1600, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1326-4", name: "Cotton Saree", price: 1600, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-1326-5", name: "Cotton Saree", price: 1600, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-1", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-2", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-3", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-4", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-5", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-6", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-8", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-9", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                { code: "MG-K3-10", name: "Cotton Saree", price: 570, category: "Sarees", qty: 1, sold: 0 },
                
                // OS Series (Old Stock)
                { code: "OS-1", name: "Kalyani Cotton", price: 900, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-2", name: "Kalyani Cotton", price: 900, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-3", name: "Kalyani Cotton", price: 900, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-4", name: "Kalyani Cotton", price: 850, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-5", name: "Kalyani Cotton", price: 850, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-6", name: "Kalyani Cotton", price: 900, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-7", name: "Kalyani Cotton", price: 1350, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-8", name: "Kalyani Cotton", price: 1350, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-9", name: "Kalyani Cotton", price: 1350, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-10", name: "9 Yards Kalyani", price: 2000, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-11", name: "9 Yards Kalyani", price: 2000, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-12", name: "6 Yards Kalyani", price: 1100, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-13", name: "6 Yards Kalyani", price: 1100, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-14", name: "Kalyani Cotton", price: 1200, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-15", name: "Kalyani Cotton", price: 1200, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-16", name: "Kalyani Cotton", price: 1200, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-17", name: "Kalyani Cotton", price: 450, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-18", name: "Kalyani Cotton", price: 450, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-19", name: "Kalyani Cotton", price: 450, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-20", name: "Kalyani Cotton", price: 450, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-21", name: "Kalyani Cotton", price: 750, category: "Sarees", qty: 1, sold: 0 },
                { code: "OS-22", name: "Kalyani Cotton", price: 750, category: "Sarees", qty: 1, sold: 0 },
                
                // ====== CHUDIDHARS ======
                // MG Series
                { code: "MG-VC87-1-1", name: "Chudidhar", price: 1400, category: "Chudidhars", qty: 1, sold: 0 },
                { code: "MG-VC87-2-1", name: "Chudidhar", price: 1200, category: "Chudidhars", qty: 1, sold: 0 },
                { code: "MG-VC87-2-2", name: "Chudidhar", price: 1200, category: "Chudidhars", qty: 1, sold: 0 },
                { code: "MG-VC87-2-3", name: "Chudidhar", price: 1200, category: "Chudidhars", qty: 1, sold: 0 },
                { code: "MG-VC87-3-1", name: "Chudidhar", price: 1200, category: "Chudidhars", qty: 1, sold: 0 },
                
                // SC Series
                { code: "SC-101-1-15", name: "Chudidhar", price: 1000, category: "Chudidhars", qty: 15, sold: 0 },
                { code: "SC-338-5", name: "Chudidhar", price: 1300, category: "Chudidhars", qty: 5, sold: 0 },
                { code: "SC-307-3", name: "Chudidhar", price: 1650, category: "Chudidhars", qty: 3, sold: 0 }
            ];
            
            localStorage.setItem('sareeShopProducts', JSON.stringify(products));
        }

        // ========== PAGE MANAGEMENT ==========
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.main-container').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(`${pageId}-page`).classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Refresh data if needed
            if (pageId === 'inventory') {
                displaySavedBills();
            } else if (pageId === 'analytics') {
                updateAnalytics();
            }
        }

        // ========== BILLING PAGE FUNCTIONS ==========
        // Initialize the billing page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize bill number and date
            document.getElementById('billNumber').value = currentBillNumber;
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('billDate').value = today;
            
            // Display all products initially
            displayProducts(products);
            
            // Set up category click events
            setupCategories();
            
            // Set up payment method change
            setupPaymentMethods();
            
            // Set up button events
            setupButtonEvents();
        });

        // Display products in the items grid
        function displayProducts(productsToDisplay) {
            const itemsGrid = document.getElementById('itemsGrid');
            itemsGrid.innerHTML = '';
            
            if (productsToDisplay.length === 0) {
                itemsGrid.innerHTML = '<div class="empty-category">No products available in this category</div>';
                return;
            }
            
            productsToDisplay.forEach(product => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                
                // Enhanced stock display
                let stockText = '';
                let stockStatusClass = '';
                if (product.qty <= 0) {
                    stockText = 'Out of Stock';
                    stockStatusClass = 'out-of-stock';
                } else if (product.qty <= 3) {
                    stockText = `Low Stock (${product.qty})`;
                    stockStatusClass = 'low-stock';
                } else {
                    stockText = `In Stock (${product.qty})`;
                }
                
                itemCard.innerHTML = `
                    <div class="item-code">${product.code}</div>
                    <div class="item-name">${product.name}</div>
                    <div class="item-price">₹${product.price}</div>
                    <div class="item-category">${product.category}</div>
                    <div class="item-stock ${stockStatusClass}">${stockText}</div>
                `;
                
                // Only allow adding to bill if in stock
                if (product.qty > 0) {
                    itemCard.addEventListener('click', function() {
                        addToBill(product);
                    });
                } else {
                    itemCard.style.opacity = '0.7';
                    itemCard.style.cursor = 'not-allowed';
                }
                
                itemsGrid.appendChild(itemCard);
            });
        }

        // Set up category filtering
        function setupCategories() {
            const categories = document.querySelectorAll('.category');
            
            categories.forEach(category => {
                category.addEventListener('click', function() {
                    // Update active category
                    document.querySelector('.category.active').classList.remove('active');
                    this.classList.add('active');
                    
                    // Filter products
                    const categoryName = this.textContent;
                    if (categoryName === "All Products") {
                        displayProducts(products);
                    } else {
                        const filteredProducts = products.filter(product => product.category === categoryName);
                        
                        if (filteredProducts.length === 0) {
                            const itemsGrid = document.getElementById('itemsGrid');
                            itemsGrid.innerHTML = `<div class="empty-category">No ${categoryName.toLowerCase()} available in inventory</div>`;
                        } else {
                            displayProducts(filteredProducts);
                        }
                    }
                });
            });
        }

        // Set up payment methods
        function setupPaymentMethods() {
            const paymentMethods = document.querySelectorAll('input[name="payment"]');
            paymentMethods.forEach(method => {
                method.addEventListener('change', function() {
                    console.log("Payment method changed to:", this.id);
                });
            });
        }

        // Set up button events
        function setupButtonEvents() {
            document.getElementById('printBillBtn').addEventListener('click', printBill);
            document.getElementById('saveBillBtn').addEventListener('click', saveBill);
            document.getElementById('newBillBtn').addEventListener('click', newBill);
        }

        // Add product to bill with per-item discount
        function addToBill(product) {
            // First check current stock from products array (not just the displayed product)
            const currentProduct = products.find(p => p.code === product.code);
            if (!currentProduct || currentProduct.qty <= 0) {
                alert('This item is now out of stock!');
                // Refresh display to show current stock status
                const activeCategory = document.querySelector('.category.active').textContent;
                if (activeCategory === "All Products") {
                    displayProducts(products);
                } else {
                    const filteredProducts = products.filter(p => p.category === activeCategory);
                    displayProducts(filteredProducts);
                }
                return;
            }
            
            const billItems = document.getElementById('billItems');
            const existingRow = Array.from(billItems.children).find(row => 
                row.cells[0].textContent === product.code
            );
            
            if (existingRow) {
                const currentQty = parseInt(existingRow.cells[4].textContent);
                if (currentQty >= currentProduct.qty) {
                    alert(`Only ${currentProduct.qty} items available in stock!`);
                    return;
                }
                
                // Increase quantity
                const qtyCell = existingRow.cells[4];
                const newQty = currentQty + 1;
                qtyCell.textContent = newQty;
                
                // Get current discount
                const discountInput = existingRow.cells[3].querySelector('input');
                const discount = discountInput ? parseFloat(discountInput.value) || 0 : 0;
                
                // Update total
                const price = parseFloat(existingRow.cells[2].textContent.replace('₹', ''));
                existingRow.cells[5].textContent = `₹${(price * (1 - discount/100) * newQty).toFixed(2)}`;
            } else {
                // Add new row with discount input
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>₹${product.price}</td>
                    <td><input type="number" class="discount-input" value="0" min="0" max="100" 
                         onchange="updateItemTotals(this)" style="width: 40px;"></td>
                    <td>1</td>
                    <td>₹${product.price}</td>
                    <td><button class="btn btn-sm" onclick="removeFromBill(this)">Remove</button></td>
                `;
                billItems.appendChild(row);
            }
            
            // Update subtotal and grand total
            updateSubtotal();
        }

        // Update item totals when discount changes
        function updateItemTotals(input) {
            const row = input.parentNode.parentNode;
            const price = parseFloat(row.cells[2].textContent.replace('₹', ''));
            const discount = parseFloat(input.value) || 0;
            const quantity = parseInt(row.cells[4].textContent);
            
            // Update total
            row.cells[5].textContent = `₹${(price * (1 - discount/100) * quantity).toFixed(2)}`;
            
            // Update totals
            updateSubtotal();
        }

        // Update subtotal
        function updateSubtotal() {
            const rows = document.getElementById('billItems').children;
            let subtotal = 0;
            
            for (let row of rows) {
                subtotal += parseFloat(row.cells[5].textContent.replace('₹', ''));
            }
            
            document.getElementById('subtotalAmount').textContent = `₹${subtotal.toFixed(2)}`;
            document.getElementById('grandTotal').textContent = `₹${subtotal.toFixed(2)}`;
        }

        // Remove item from bill
        function removeFromBill(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
            updateSubtotal();
        }

        // Print bill
        function printBill() {
            window.print();
        }

        // Save bill with per-item discounts
        function saveBill() {
            const billNumber = document.getElementById('billNumber').value;
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const paymentMethod = document.querySelector('input[name="payment"]:checked').id;
            
            // Validate
            if (document.getElementById('billItems').children.length === 0) {
                alert('Please add items to the bill before saving');
                return;
            }
            
            // Prepare bill data and update stock
            const billItems = Array.from(document.getElementById('billItems').children);
            const itemsData = [];
            
            for (let row of billItems) {
                const code = row.cells[0].textContent;
                const quantity = parseInt(row.cells[4].textContent);
                const discount = parseFloat(row.cells[3].querySelector('input').value) || 0;
                
                // Find product in inventory
                const productIndex = products.findIndex(p => p.code === code);
                if (productIndex !== -1) {
                    // Update stock
                    products[productIndex].qty -= quantity;
                    products[productIndex].sold += quantity;
                    
                    // Add to bill items
                    itemsData.push({
                        code,
                        name: row.cells[1].textContent,
                        price: parseFloat(row.cells[2].textContent.replace('₹', '')),
                        discount,
                        quantity,
                        total: parseFloat(row.cells[5].textContent.replace('₹', ''))
                    });
                }
            }
            
            // Save updated products
            localStorage.setItem('sareeShopProducts', JSON.stringify(products));
            
            // Prepare bill data
            const billData = {
                billNumber,
                date: document.getElementById('billDate').value,
                customer: { name: customerName, phone: customerPhone },
                paymentMethod,
                items: itemsData,
                subtotal: parseFloat(document.getElementById('subtotalAmount').textContent.replace('₹', '')),
                grandTotal: parseFloat(document.getElementById('grandTotal').textContent.replace('₹', ''))
            };
            
            // Add to saved bills
            savedBills.push(billData);
            localStorage.setItem('sareeShopBills', JSON.stringify(savedBills));
            
            // Update bill number for next bill
            currentBillNumber = parseInt(billNumber) + 1;
            
            // Refresh the product display to show updated stock levels
            const activeCategory = document.querySelector('.category.active').textContent;
            if (activeCategory === "All Products") {
                displayProducts(products);
            } else {
                const filteredProducts = products.filter(product => product.category === activeCategory);
                displayProducts(filteredProducts);
            }
            
            alert(`Bill ${billNumber} saved successfully!`);
            showPage('inventory');
        }

        // New bill
        function newBill() {
            if (confirm('Start a new bill? Current bill will be cleared.')) {
                // Clear bill items
                document.getElementById('billItems').innerHTML = '';
                
                // Reset totals
                document.getElementById('subtotalAmount').textContent = '₹0';
                document.getElementById('grandTotal').textContent = '₹0';
                
                // Set new bill number
                document.getElementById('billNumber').value = currentBillNumber;
                
                // Reset customer details
                document.getElementById('customerName').value = '';
                document.getElementById('customerPhone').value = '';
                
                // Set today's date
                document.getElementById('billDate').value = new Date().toISOString().split('T')[0];
                
                // Reset payment method
                document.getElementById('cash').checked = true;
            }
        }

        // ========== INVENTORY PAGE FUNCTIONS ==========
        // Display saved bills
        function displaySavedBills() {
            const billList = document.getElementById('billList');
            billList.innerHTML = '';
            
            if (savedBills.length === 0) {
                billList.innerHTML = '<div class="empty-category">No bills saved yet</div>';
                return;
            }
            
            savedBills.forEach(bill => {
                const billItem = document.createElement('div');
                billItem.className = 'bill-item';
                billItem.innerHTML = `
                    <div class="bill-header">
                        <span class="bill-number">Bill #${bill.billNumber}</span>
                        <span class="bill-date">${bill.date}</span>
                    </div>
                    <div class="bill-customer">${bill.customer.name || 'No name'} | ${bill.customer.phone || 'No phone'}</div>
                    <div class="bill-total">₹${bill.grandTotal.toFixed(2)}</div>
                    <div class="bill-details" id="details-${bill.billNumber}">
                        <table class="bill-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Price</th>
                                    <th>Disc%</th>
                                    <th>Qty</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${bill.items.map(item => `
                                    <tr>
                                        <td>${item.code} - ${item.name}</td>
                                        <td>₹${item.price.toFixed(2)}</td>
                                        <td>${item.discount}%</td>
                                        <td>${item.quantity}</td>
                                        <td>₹${item.total.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4">Subtotal</td>
                                    <td>₹${bill.subtotal.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td colspan="4">Grand Total</td>
                                    <td>₹${bill.grandTotal.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td colspan="4">Payment Method</td>
                                    <td>${bill.paymentMethod}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                `;
                
                // Add click event to toggle details
                billItem.addEventListener('click', function() {
                    const details = document.getElementById(`details-${bill.billNumber}`);
                    details.style.display = details.style.display === 'block' ? 'none' : 'block';
                });
                
                billList.appendChild(billItem);
            });
        }

        // Filter bills based on search input
        function filterBills() {
            const searchTerm = document.getElementById('searchBills').value.toLowerCase();
            const billItems = document.querySelectorAll('.bill-item');
            
            billItems.forEach(item => {
                const billText = item.textContent.toLowerCase();
                if (billText.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ========== ANALYTICS PAGE FUNCTIONS ==========
        function updateAnalytics() {
            updateDailySales();
            updateStockAnalysis();
            updateTopProducts();
            updateDeadStock();
        }

        function updateDailySales() {
            const today = new Date().toISOString().split('T')[0];
            const dailySales = savedBills
                .filter(bill => bill.date === today)
                .reduce((total, bill) => total + bill.grandTotal, 0);
            
            // Set a daily target (you can adjust this)
            const dailyTarget = 10000; // ₹10,000 daily target
            const progress = Math.min((dailySales / dailyTarget) * 100, 100);
            
            // Update the circular progress
            const circle = document.querySelector('.progress-circle-fill');
            const circumference = 2 * Math.PI * 45;
            const offset = circumference - (progress / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // Update the text
            document.getElementById('daily-sales-value').textContent = `₹${dailySales.toFixed(2)}`;
            document.getElementById('daily-sales-details').innerHTML = `
                <div style="text-align: center; margin-top: 10px;">
                    <div>Daily Target: ₹${dailyTarget.toFixed(2)}</div>
                    <div>Progress: ${progress.toFixed(1)}%</div>
                </div>
            `;
        }

        function updateStockAnalysis() {
            // Categorize stock
            let goodStock = 0, goodStockValue = 0;
            let lowStock = 0, lowStockValue = 0;
            let deadStock = 0, deadStockValue = 0;
            
            products.forEach(product => {
                const value = product.price * product.qty;
                if (product.qty === 0) {
                    deadStock++;
                    deadStockValue += value;
                } else if (product.qty <= 3) {
                    lowStock++;
                    lowStockValue += value;
                } else {
                    goodStock++;
                    goodStockValue += value;
                }
            });
            
            // Update the table
            const tableBody = document.getElementById('stock-analysis-body');
            tableBody.innerHTML = `
                <tr class="good-stock">
                    <td>Good Stock (>3 items)</td>
                    <td>${goodStock}</td>
                    <td>₹${goodStockValue.toFixed(2)}</td>
                </tr>
                <tr class="low-stock-row">
                    <td>Low Stock (1-3 items)</td>
                    <td>${lowStock}</td>
                    <td>₹${lowStockValue.toFixed(2)}</td>
                </tr>
                <tr class="dead-stock">
                    <td>Dead Stock (0 items)</td>
                    <td>${deadStock}</td>
                    <td>₹${deadStockValue.toFixed(2)}</td>
                </tr>
            `;
        }

        function updateTopProducts() {
            // Get top 5 selling products
            const topProducts = [...products]
                .filter(p => p.sold > 0)
                .sort((a, b) => b.sold - a.sold)
                .slice(0, 5);
            
            // Simple text-based chart
            const chartContainer = document.getElementById('top-products-chart');
            chartContainer.innerHTML = `
                <div style="display: flex; height: 100%; align-items: flex-end; gap: 20px; justify-content: center;">
                    ${topProducts.map(product => `
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="width: 40px; background: var(--primary-color); height: ${(product.sold / topProducts[0].sold) * 100}%;"></div>
                            <div style="margin-top: 5px; font-size: 12px; text-align: center;">
                                ${product.code}<br>${product.sold} sold
                            </div>
                        </div>
                    `).join('')}
                </div>
                ${topProducts.length === 0 ? '<div style="text-align: center; padding: 20px;">No sales data yet</div>' : ''}
            `;
        }

        function updateDeadStock() {
            // Find products with no sales in last 30 days
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const deadStockItems = products.filter(product => {
                // Check if product has any sales
                if (product.sold === 0) return true;
                
                // Check if any bills contain this product in last 30 days
                const productBills = savedBills.filter(bill => 
                    bill.items.some(item => item.code === product.code) &&
                    new Date(bill.date) >= thirtyDaysAgo
                );
                
                return productBills.length === 0;
            });
            
            // Update the table
            const tableBody = document.getElementById('dead-stock-body');
            tableBody.innerHTML = deadStockItems.map(product => `
                <tr>
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.qty}</td>
                    <td>${product.sold > 0 ? 'Over 30 days ago' : 'Never sold'}</td>
                </tr>
            `).join('') || '<tr><td colspan="5" style="text-align: center;">No dead stock found</td></tr>';
        }
    </script>
</body>
</html>